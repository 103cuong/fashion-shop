extends ../layout/common
block title
	title Cart
block head
	link(rel='stylesheet', type='text/css', href='vendor/select2/select2.min.css')
	// ===============================================================================================
	link(rel='stylesheet', type='text/css', href='vendor/slick/slick.css')
block content
	// Title Page
	section.bg-title-page.p-t-40.p-b-50.flex-col-c-m(style='background-image: url(images/heading-pages-01.jpg);')
		h2.l-text2.t-center
			| Cart
	// Cart
	section.cart.bgwhite.p-t-70.p-b-100
		.container
			// Cart item
			.container-table-cart.pos-relative
				.wrap-table-shopping-cart.bgwhite
					table.table-shopping-cart
						tbody
							tr.table-head
								th.column-1
								th.column-2 Product
								th.column-3 Price
								th.column-4.p-l-70 Quantity
								th.column-5 Total
							- var totalPrice = 0
							each item in cart
								tr.table-row(id=`table-row-${JSON.stringify(item.product._id)}`)
									td.column-1
										button.cart-img-product.b-rad-4.o-f-hidden(onclick=`removeProduct(${JSON.stringify(item.product._id)})`)
											img(src=item.product.image, alt='IMG-PRODUCT')
									td.column-2= item.product.name
									td.column-3 $#{item.product.price}
									td.column-4
										.flex-w.bo5.of-hidden.w-size17
											button.btn-num-product-down.color1.flex-c-m.size7.bg8.eff2(onclick=`decreaseQuantity(${JSON.stringify(item.product._id)})`)
												i.fs-12.fa.fa-minus(aria-hidden='true')
											div
											input.size8.m-text18.t-center.num-product(id=`quantity-${JSON.stringify(item.product._id)}` type='number', name='num-product1', value=item.quantity)
											div
											button.btn-num-product-up.color1.flex-c-m.size7.bg8.eff2(onclick=`increaseQuantity(${JSON.stringify(item.product._id)})`)
												i.fs-12.fa.fa-plus(aria-hidden='true')
									td.column-5 $#{item.quantity * item.product.price}
									- totalPrice += item.quantity * item.product.price
			.flex-w.flex-sb-m.p-t-25.p-b-25.bo8.p-l-35.p-r-60.p-lr-15-sm
				.flex-w.flex-m.w-full-sm
					.size11.bo4.m-r-10
						input.sizefull.s-text7.p-l-22.p-r-22(type='text', name='coupon-code', placeholder='Coupon Code')
					.size12.trans-0-4.m-t-10.m-b-10.m-r-10
						// Button
						button.flex-c-m.sizefull.bg1.bo-rad-23.hov1.s-text1.trans-0-4
							| Apply coupon
				.size10.trans-0-4.m-t-10.m-b-10
					// Button
					button.flex-c-m.sizefull.bg1.bo-rad-23.hov1.s-text1.trans-0-4
						| Update Cart
			// Total
			.bo9.w-size18.p-l-40.p-r-40.p-t-30.p-b-38.m-t-30.m-r-0.m-l-auto.p-lr-15-sm
				h5.m-text20.p-b-24
					| Cart Totals
				// 
				.flex-w.flex-sb-m.p-b-12
					span.s-text18.w-size19.w-full-sm
						| Subtotal:
					span.m-text21.w-size20.w-full-sm
						| $#{totalPrice}
				// 
				.flex-w.flex-sb.bo10.p-t-15.p-b-20
					span.s-text18.w-size19.w-full-sm
						| Shipping:
					.w-size20.w-full-sm
						p.s-text8.p-b-23
							| There are no shipping methods available. Please double check your address, or contact us if you need any help.
						span.s-text19
							| Calculate Shipping
						.rs2-select2.rs3-select2.rs4-select2.bo4.of-hidden.w-size21.m-t-8.m-b-12
							select.selection-2(name='country')
								option Select a country...
								each country in countries
									option= country.countryName
						.size13.bo4.m-b-12
							input.sizefull.s-text7.p-l-15.p-r-15(type='text', name='state', placeholder='State / country')
						.size13.bo4.m-b-22
							input.sizefull.s-text7.p-l-15.p-r-15(type='text', name='postcode', placeholder='Postcode / Zip')
						.size14.trans-0-4.m-b-10
							// Button
							button.flex-c-m.sizefull.bg1.bo-rad-23.hov1.s-text1.trans-0-4
								| Update Totals
				// 
				.flex-w.flex-sb-m.p-t-26.p-b-30
					span.m-text22.w-size19.w-full-sm
						| Total:
					span.m-text21.w-size20.w-full-sm
						| $#{totalPrice}
				.size15.trans-0-4
					// Button
					button.flex-c-m.sizefull.bg1.bo-rad-23.hov1.s-text1.trans-0-4
						| Proceed to Checkout
block script
	script(type='text/javascript', src='vendor/jquery/jquery-3.2.1.min.js')
	// ===============================================================================================
	script(type='text/javascript', src='vendor/animsition/js/animsition.min.js')
	// ===============================================================================================
	script(type='text/javascript', src='vendor/bootstrap/js/popper.js')
	script(type='text/javascript', src='vendor/bootstrap/js/bootstrap.min.js')
	// ===============================================================================================
	script(type='text/javascript', src='vendor/select2/select2.min.js')
	script(type='text/javascript').
		$(".selection-1").select2({
		minimumResultsForSearch: 20,
		dropdownParent: $('#dropDownSelect1')
		});
		$(".selection-2").select2({
		minimumResultsForSearch: 20,
		dropdownParent: $('#dropDownSelect2')
		});
	// ===============================================================================================
	script(type='text/javascript', src='https://unpkg.com/axios/dist/axios.min.js')
	script(type='text/javascript').
		// increase quantity
		const increaseQuantity = async (productId) => {
			const res = await axios.get(`/cart/increaseQuantity/${productId}`)
			const quantityInput = document.getElementById(`quantity-${JSON.stringify(productId)}`)
			quantityInput.value = res.data.quantity
		}

		// decrease quantity
		const decreaseQuantity = async (productId) => {
			const res = await axios.get(`/cart/decreaseQuantity/${productId}`)
			const quantityInput = document.getElementById(`quantity-${JSON.stringify(productId)}`)
			if (res.data.quantity === 0) {
				const idTableRow = `table-row-${JSON.stringify(productId)}`
				document.getElementById(idTableRow).remove()
			}
			quantityInput.value = res.data.quantity
		}

		// remove product
		const removeProduct = productId => {
			axios.delete(`/cart/${productId}`)
			const idTableRow = `table-row-${JSON.stringify(productId)}`
			document.getElementById(idTableRow).remove()
		}
	// ===============================================================================================
	script(src='js/main.js')
